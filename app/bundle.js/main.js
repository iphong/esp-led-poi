!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);n(1),n(2),n(3),n(4),n(5),n(6),n(7)},function(module,exports){document.head.innerHTML+="<style>\n\nx-console main {\n\tpadding: 0;\n\tmargin: 0;\n}\nx-console {\n\tz-index: 2000;\n\tdisplay: block;\n\tposition: fixed;\n\tbottom: 0;\n\tright: 0;\n\tleft: 0;\n\t\n\tbackground: #020202c9;\n\tborder: 10px solid #020202c9;\n\t\n\tbox-sizing: content-box;\n\tmax-height: 120px;\n\toverflow: auto;\n}\nx-console input,\nx-console output,\nx-console span {\n\tuser-select: text;\n\tfont-family: menlo;\n\tfont-size: 12px;\n\tline-height: 1.5em;\n}\nx-console input,\nx-console span {\n\theight: 1.5em;\n}\nx-console input,\nx-console output {\n\tdisplay: block;\n\tmargin: 0;\n\tpadding: 0;\n\tborder: none;\n\tbackground: none;\n\toutline: none;\n\twhite-space: pre !important;\n\tcolor: #fff;\n\ttext-align: left;\n}\nx-console line {\n\tdisplay: grid;\n\tgrid-template-columns: 20px auto;\n}\nx-console line span,\nx-console line output {\n\tcolor: lightgrey;\n}\nx-console line.debug * {\n\tcolor: lightgreen;\n}\nx-console line.info * {\n\tcolor: skyblue;\n}\nx-console line.warn * {\n\tcolor: yellow;\n}\nx-console line.error * {\n\tcolor: orangered;\n}\nx-console line.input * {\n\tcolor: white;\n}\nx-console line.input {\n\tdisplay: none;\n}\n</style>";class ConsoleElement{constructor(){this.el=document.createElement("x-console"),this.el.innerHTML='\n\t\t<main></main>\n\t\t<line class="input">\n\t\t\t<span>#</span>\n\t\t\t<input type="text" />\n\t\t</line>\n\t\t',this.main=this.el.querySelector("main"),this.input=this.el.querySelector("input"),this.input.addEventListener("keydown",this.handleKeydown.bind(this))}handleKeydown(e){if("Enter"===e.key){this.push("#","",e.target.value);try{this.push("•","info",String(eval(e.target.value)))}catch(e){this.push("•","error",e.stack)}e.target.value="",e.target.focus()}}push(e,t,...n){const o=document.createElement("line");t&&o.classList.add(t),o.innerHTML=`<span>${e}</span><output></output>`;const r=o.querySelector("output");r.innerText=n.join(" "),this.lastOutput=r,this.main.appendChild(o),this.el.scrollTop=this.el.scrollHeight}}const logger=new ConsoleElement;document.body.appendChild(logger.el);const original={};for(let e in console)original[e]=console[e];window.console.log=(...e)=>{original.log(...e),logger.push("•","log",...e)},window.console.debug=(...e)=>{original.debug(...e),logger.push("•","debug",...e)},window.console.info=(...e)=>{original.info(...e),logger.push("•","info",...e)},window.console.warn=(...e)=>{original.warn(...e),logger.push("•","warn",...e)},window.console.error=(...e)=>{original.error(...e),logger.push("•","error",...e)},window.console.append=(...e)=>{logger.lastOutput&&(logger.lastOutput.innerHTML=`${logger.lastOutput.innerHTML}${e.join(" ")}`)}},function(e,t){Object.assign({},{id:0,url:"",filename:"",duration:0,channels:0,sampleRate:0,tempo:0,beats:0,tracks:[],color1:"#0000FF",color2:"#FF0000",ratio:.5,swap:!0});let n={rgb:{r:255,g:0,b:0},hsl:{h:255,s:0,l:0}};!function(){const{r:e,g:t,b:o}=n.rgb;n.hsl=rgbToHsl(e,t,o)}()},function(e,t){},function(e,t){Date.now()},function(e,t){},function(e,t){window.AudioContext||window.webkitAudioContext},function(e,t){function n(e){return new Promise((t,n)=>{console.debug("select file: "+e.name),e.name.endsWith(".lsf")||e.name.endsWith(".ipx")||(e.type.startsWith("audio")?stopShow().then(()=>{setAttr("#player","src",URL.createObjectURL(e)),AUDIO&&AUDIO.filename===e.name?startShow().then(t):parseAudio(e).then(saveLightShow).then(t).then(startShow)}):(console.error("unsupported file format"),n("unsupported file format")))})}function o(e){if("change"===e.type&&"select-file"===e.target.id)for(let t of e.target.files)n(t);else if(e.target.matches("grid.color-slider input")){const t=e.target.dataset.key,n=e.target.dataset.group;switch(color[n][t]=parseFloat(e.target.value),n){case"rgb":updateHSL();break;case"hsl":updateRGB()}renderColor(),"change"===e.type&&post("/color",Object.assign({segment:CONFIG.segment},color.rgb))}else if(e.target.matches('input[data-group="audio"]')){const{key:t}=e.target.dataset,n=e.target.value;switch(e.target.type){case"color":AUDIO[t]=n;break;case"range":AUDIO[t]=parseFloat(n)}"change"===e.type&&console.info(`set ${t} = ${JSON.stringify(AUDIO[t])}`)}}window.addEventListener("dragover",(function(e){e.preventDefault()}),!0),window.addEventListener("dragleave",(function(e){e.preventDefault()}),!0),window.addEventListener("drop",(function(e){e.preventDefault();for(let t of e.dataTransfer.files)n(t)}),!0),window.addEventListener("change",o,!0),window.addEventListener("input",o,!0),window.addEventListener("click",(function(e){if(e.target.dataset.segment)CONFIG.segment=e.target.dataset.segment,color={rgb:CONFIG[CONFIG.segment]},updateHSL(),render();else if(e.target.dataset.show)CONFIG.show=parseInt(e.target.dataset.show)||0,render(),stopShow().then(()=>{post("/config",{show:CONFIG.show}).then(()=>{CONFIG.show?loadAudioConfig():startShow()})});else if(e.target.dataset.action){switch(e.target.dataset.action){case"show-file-select-dialog":click("#select-file");break;case"reset-show-data":resetShow();break;case"save-show-data":saveShow();break;case"toggle-prop":const t=e.target.dataset.key;AUDIO[t]=!AUDIO[t],console.info(`set ${t} = ${AUDIO[t]?"on":"off"}`)}}else if(e.target.dataset.command){const t=e.target.dataset.command;sendCommand(t).then(()=>{switch(t){case"start":setProp("#player","currentTime",0),call("#player","play");break;case"resume":call("#player","play");break;case"end":call("#player","pause"),setProp("#player","currentTime",0);break;case"pause":call("#player","pause")}})}}),!0),window.addEventListener("touchstart",new Function,!0),window.addEventListener("load",(function(){render(),fetchData()}))}]);