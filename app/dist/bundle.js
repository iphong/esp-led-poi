window.ledc=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o}));const a={brightness:255,channel:0,show:0,nodes:[]},r={filename:null,channels:[],duration:0},o={params:{},tracks:[]};e.color={rgb:{r:255,g:0,b:0},hsl:{h:255,s:0,l:0}},e.updateRGB=function(){const{h:e,s:t,l:n}=color.hsl;color.rgb=hslToRgb(e,t,n)},e.updateHSL=function(){const{r:e,g:t,b:n}=color.rgb;color.hsl=rgbToHsl(e,t,n)},Object.assign(e,{CONFIG:a,AUDIO:r,LIGHT:o})}).call(this,n(3))},function(e,t,n){"use strict";n.r(t),n.d(t,"$",(function(){return r})),n.d(t,"setText",(function(){return o})),n.d(t,"setValue",(function(){return s})),n.d(t,"setProp",(function(){return c})),n.d(t,"setAttr",(function(){return i})),n.d(t,"click",(function(){return l})),n.d(t,"call",(function(){return d})),n.d(t,"renderHead",(function(){return u})),n.d(t,"renderNodes",(function(){return f})),n.d(t,"renderShow",(function(){return h})),n.d(t,"renderLight",(function(){return p})),n.d(t,"renderWaveform",(function(){return m})),n.d(t,"render",(function(){return y}));var a=n(0);function r(e){return document.body.querySelectorAll(e)}function o(e,t){void 0!==t&&r(e).forEach(e=>{e.innerHTML=t})}function s(e,t){void 0!==t&&r(e).forEach(e=>{e.value=t})}function c(e,t,n){void 0!==n&&r(e).forEach(e=>{e[t]=n})}function i(e,t,n){void 0!==n&&r(e).forEach(e=>{e.setAttribute(t,n)})}function l(e){r(e).forEach(e=>{e.click()})}function d(e,t,...n){r(e).forEach(e=>{"function"==typeof e[t]&&e[t].call(e,...n)})}function u(){const{id:e,ip:t,mac:n,brightness:r,channel:s,show:c}=a.b;o("#id",e),o("#ip",t),o("#mac",n)}function f(){r("section.nodes").forEach(e=>{e.innerHTML="",a.b.nodes.forEach(t=>{const n=document.createElement("article");n.classList.add("node"),n.innerHTML=t.id,n.dataset.device=t.id,n.dataset.droppable=!0,e.appendChild(n)})})}function h(){r("[data-show]").forEach(e=>{parseInt(e.dataset.show)===a.b.show?e.classList.add("selected"):e.classList.remove("selected")}),r(".tracks").forEach(e=>{e.innerHTML="",e.style.width=a.c.params.end/50+"px",a.c.tracks.forEach(t=>{const n=document.createElement("div"),{elements:a,...r}=t;n.classList.add("track"),Object.assign(n.dataset,r),e.appendChild(n),p(n,t)})})}function p(e,t){switch(t.device){case 1:e.style.height="40px";break;case 2:e.style.height="20px";break;default:return console.log("unsupported device type:",t.device)}t.elements.forEach(t=>{const n=document.createElement("span");let{color:a,colorStart:r,colorEnd:o,...s}=t;Object.assign(n.dataset,s);const c=s.startTime,i=s.endTime-t.startTime;let l,d;switch(a&&(a=g(a)),r&&(r=g(r)),o&&(o=g(o)),n.style.left=c/50+"px",n.style.width=i/50+"px",s.type){case 2:n.style.backgroundColor=w(a);break;case 3:l=w(r),d=w(o),n.style.background=`linear-gradient(90deg, ${l} 0%, ${d} 100%)`;break;case 4:l=w(r),d=w(o);const{period:e,ratio:t}=s;n.style.backgroundImage=`url(${function(e,t,n,a){b.width=n,b.height=1;const r=b.getContext("2d"),o=n*(a/100),s=n*((100-a)/100);return r.fillStyle=e,r.fillRect(0,0,o,1),r.fillStyle=t,r.fillRect(o,0,s,1),b.toDataURL()}(l,d,e,t)})`,n.style.backgroundSize="20%";break;case 5:n.style.backgroundImage=`url(${function(e){b.width=e,b.height=1;const t=b.getContext("2d");var n=t.createLinearGradient(0,0,e,0);return n.addColorStop(0,"red"),n.addColorStop(1/6*1,"orange"),n.addColorStop(1/6*2,"yellow"),n.addColorStop(.5,"green"),n.addColorStop(1/6*4,"cyan"),n.addColorStop(1/6*5,"blue"),n.addColorStop(1,"violet"),t.fillStyle=n,t.fillRect(0,0,e,1),b.toDataURL()}(s.period)})`,n.style.backgroundSize="20%";break;case 6:n.style.backgroundImage=`url(${function(e,t){b.width=t+2,b.height=1;const n=b.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,1,1),n.fillStyle="black",n.fillRect(1,0,1,1),b.toDataURL()}(w(a),s.spacing)})`,n.style.backgroundSize="20%";break;case 7:n.style.backgroundImage=`url(${function(e,t){b.width=t,b.height=1;const n=b.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,t,1),n.fillStyle="black",n.fillRect(0,0,24,1),n.fillStyle="white",n.fillRect(12,0,2,1),b.toDataURL()}(w(a),s.period)})`,n.style.backgroundSize="20%"}e.appendChild(n)})}function g({r:e,g:t,b:n}){return{r:Math.round(255*e),g:Math.round(255*t),b:Math.round(255*n)}}function w({r:e,g:t,b:n}){return`rgb(${e}, ${t}, ${n})`}const b=document.createElement("canvas");function m(){r("canvas.waveform").forEach((e,t)=>{const n=e.getContext("2d"),r=e.parentElement,o=a.a.channels[t].data,s=e.offsetHeight,c=20*a.a.duration,i=s/2;length=o.length;const l=Math.round(length/c);e.width=c,e.height=s,e.style.width=c+"px",e.style.height=s+"px",e.style.left=Math.round(r.clientWidth/2)+"px";let d=0,u=0,f=0,h=0,p=0,g=0,w=0,b=l;for(let e=0;e<length;e++)if(e==b){const e=p*i+i;n.strokeStyle="#333333",n.strokeRect(d,e,1,h*i+i-e);const t=f/g*i+i;n.strokeStyle="#eeeeee",n.strokeRect(d,t,1,u/w*i+i-t),d++,b+=l,u=0,f=0,h=0,p=0,g=0,w=0}else o[e]<0?(f+=o[e],g++,p>o[e]&&(p=o[e])):(u+=o[e],w++,h<o[e]&&(h=o[e]))})}function y(){u(),h()}Object.assign(window,{$:r,setText:o,setValue:s,setProp:c,setAttr:i,click:l,call:d,render:y})},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1);const{fetchData:r,post:o,uploadFile:s,get:c,loadNodes:i}=n(5),{parseAudio:l}=n(6),{parseLSF:d}=n(4);function u(){console.error(...arguments)}async function f(e,t){if(console.debug("select file: "+e.name),e.name.endsWith(".lsf")){const n=await d(e);let a,o;t&&t.target.dataset.device&&(a=!0,o=t.target.dataset.device),1==n.length?(await s(`show/${CONFIG.show}A.lsb`,new Blob(n[0]),a,o),await s(`show/${CONFIG.show}B.lsb`,new Blob(n[0]),a,o)):3===n.length&&(await s(`show/${CONFIG.show}A.lsb`,new Blob(n[1]),a,o),await s(`show/${CONFIG.show}B.lsb`,new Blob(n[2]),a,o)),await r()}else if(e.name.endsWith(".lt3")){const t=`show/${CONFIG.show}.json`;await s(t,e),await r()}else e.name.endsWith(".ipx")||(e.type.startsWith("audio")?(Object(a.renderWaveform)(await l(e)),setAttr("#player","src",URL.createObjectURL(e))):console.error("unsupported file format"))}function h(e){if("change"===e.type&&"select-file"===e.target.id)for(let t of e.target.files)f(t);else if(e.target.matches("grid.color-slider input")){const t=e.target.dataset.key,n=e.target.dataset.group;switch(color[n][t]=parseFloat(e.target.value),n){case"rgb":updateHSL();break;case"hsl":updateRGB()}renderColor(),"change"===e.type&&o("/color",Object.assign({segment:CONFIG.segment},color.rgb))}else if(e.target.matches('input[data-group="audio"]')){const{key:t}=e.target.dataset,n=e.target.value;switch(e.target.type){case"color":AUDIO[t]=n;break;case"range":AUDIO[t]=parseFloat(n)}"change"===e.type&&console.info(`set ${t} = ${JSON.stringify(AUDIO[t])}`)}}window.addEventListener("scroll",(function(e){}),!0),window.addEventListener("dragover",(function(e){e.preventDefault();const t=e.target.closest("[data-dropppable]");t&&t.classList.add("active")}),!0),window.addEventListener("dragleave",(function(e){e.preventDefault();const t=e.target.closest("[data-dropppable]");t&&t.classList.remove("active")}),!0),window.addEventListener("drop",(function(e){e.preventDefault();for(let t of e.dataTransfer.files)f(t,e)}),!0),window.addEventListener("change",h,!0),window.addEventListener("input",h,!0),window.addEventListener("click",(async function(e){if(e.target.matches("article.node")){const t=e.target.dataset.device;o("blink?target="+t)}else if(e.target.dataset.segment)CONFIG.segment=e.target.dataset.segment,color={rgb:CONFIG[CONFIG.segment]},await updateHSL(),await render();else if(e.target.dataset.show)CONFIG.show=parseInt(e.target.dataset.show)||0,await render(),await o("show",{id:CONFIG.show}),CONFIG.show&&await loadShowData(),render();else if(e.target.dataset.action){switch(e.target.dataset.action){case"show-file-select-dialog":click("#select-file");break;case"reset-show-data":case"save-show-data":break;case"toggle-prop":const t=e.target.dataset.key;AUDIO[t]=!AUDIO[t],console.info(`set ${t} = ${AUDIO[t]?"on":"off"}`)}}else if(e.target.dataset.command){const t=e.target.dataset.command;switch(await o("exec?cmd="+t),t){case"start":setProp("#player","currentTime",0),call("#player","play");break;case"resume":call("#player","play");break;case"end":call("#player","pause"),setProp("#player","currentTime",0);break;case"pause":call("#player","pause")}}}),!0),window.addEventListener("touchstart",new Function,!0),window.addEventListener("load",(function(){r(),setInterval(async()=>{await i()&&Object(a.renderNodes)()},5e3)}))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t),n.d(t,"parseLSF",(function(){return s})),n.d(t,"parseLT3",(function(){return c}));const a=/(\t+)?([0-9]+)ms: setrgb [AB]+ ([0-9]+)ms > ([0-9]+), ([0-9]+), ([0-9]+)/i,r=/(\t+)?([0-9]+)ms: end/i,o=/([0-9]+)ms: loop ([0-9]+)ms/i;async function s(e){return new Promise(t=>{const n=new FileReader;n.readAsText(e),n.onload=()=>{const e={},s=n.result.match(/@?\w+[^@]+/gm).map(t=>{let n="AB";return t.startsWith("@")&&(n=t[1],t=t.substr(2)),e[n]=t.trim().split(/\r|\n|\r\n/).filter(e=>!!e.match(/^[\t0-9]/)).map(e=>{let t;if(t=e.match(a)){let[,,e,n,a,r,o]=t;return{type:1,start:e,duration:0,transition:n,r:a,g:r,b:o}}if(t=e.match(r)){let[,,e]=t;return{type:2,start:e}}if(t=e.match(o)){let[,e,n]=t;return{type:3,start:e,duration:n,frames:[]}}return{}}).map(({start:e=0,duration:t=0,transition:n=0,type:a=0,r:r=0,g:o=0,b:s=0},c,i)=>{const l=new Uint8Array(16),d=new DataView(l.buffer);return 1===a&&i[c+1]&&(t=i[c+1].start-e),d.setUint8(0,a),d.setUint32(1,e),d.setUint32(5,t),d.setUint32(9,n),d.setUint8(13,r),d.setUint8(14,o),d.setUint8(15,s),l})});t(s)}})}async function c(e){}},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"request",(function(){return o})),n.d(t,"uploadFile",(function(){return s})),n.d(t,"get",(function(){return c})),n.d(t,"post",(function(){return i})),n.d(t,"exec",(function(){return l})),n.d(t,"loadShowData",(function(){return d})),n.d(t,"loadNodes",(function(){return u})),n.d(t,"fetchData",(function(){return f}));var a=n(0);const{render:r}=n(1);function o(e="POST",t="",n={},a=null){return new Promise((r,o)=>{const s=new XMLHttpRequest,c=Object.entries(n),i=t+(c.length?"?"+c.map(([e,t])=>`${e}=${t}`).join("&"):""),l=a?` [${a.size||a.length} Kb]`:"",d=console.log(`${e} ${i} ${l}... `);s.open(e,i,!0),s.send(a),s.addEventListener("load",()=>{d&&(d.innerHTML+=s.statusText),200===s.status?"application/json"===s.getResponseHeader("Content-Type")?r(JSON.parse(s.responseText),s):r(s.responseText,s):o()}),s.addEventListener("error",o)})}async function s(e,t,n=!1,a=null){const r=new Blob([t]),o=console.log(`UPLOAD ${e} [${(r.size/1e3).toFixed(2)} KB] ... `);return new Promise((t,s)=>{const c=new FormData,i=new XMLHttpRequest;c.append("filename",e),c.append("file",r),i.open("POST",`edit?${n?"sync":"nosync"}&${a?"target="+a:""}`,!0),i.send(c),i.onloadend=e=>{o&&(o.innerHTML+=i.statusText),200===i.status?t(i):s(i)}})}function c(e,t){return o("GET",e,t)}function i(e,t,n){return o("POST",e,t,n)}function l(e){return o("POST","exec",{cmd:e})}async function d(){try{const e=await c(`show/${CONFIG.show}.json`);a.c.params=e.solution,a.c.tracks=e.tracks}catch(e){console.log("show not available"),a.c.params={},a.c.tracks=[]}}async function u(){const e=await c("nodes");return e.map(e=>e.id).join()!==CONFIG.nodes.map(e=>e.id).join()&&(CONFIG.nodes=e,!0)}async function f(){const e=await c("stat");Object.assign(CONFIG,e),e.show&&await d(),r()}Object.assign(e,{request:o,get:c,post:i,uploadFile:s,loadShowData:d,fetchData:f})}.call(this,n(3))},function(e,t,n){"use strict";n.r(t),n.d(t,"parseAudio",(function(){return s}));var a=n(0),r=n(2);const o=window.AudioContext||window.webkitAudioContext;async function s(e){return new Promise(t=>{const n=new o,s=new FileReader;s.readAsArrayBuffer(e),s.addEventListener("loadend",o=>{function c(e){const{sampleRate:n,duration:r}=e,o=[];for(let t=0;t<e.numberOfChannels;t++){const n=e.getChannelData(t),{tempo:a,beats:r,peaks:s,spectralFlux:c,...i}=new MusicTempo(n);r.forEach((e,t,n)=>n[t]=Math.round(1e3*e)),o[t]={data:n,beats:r,tempo:a}}t(Object.assign(a.a,{duration:r,channels:o}))}console.log(`decoding ${e.type}...`),"chrome"in window?n.decodeAudioData(s.result).catch(r.a).then(c):n.decodeAudioData(s.result,c,r.a)})})}},function(e,t,n){"use strict";n.r(t);n(4),n(8),n(0),n(1),n(5),n(6),n(2)},function(e,t,n){(function(e){e.rgbToHsl=function(e,t,n){e/=255,t/=255,n/=255;let a,r,o=Math.max(e,t,n),s=Math.min(e,t,n),c=(o+s)/2;if(o===s)a=r=0;else{let i=o-s;switch(r=c>.5?i/(2-o-s):i/(o+s),o){case e:a=(t-n)/i+(t<n?6:0);break;case t:a=(n-e)/i+2;break;case n:a=(e-t)/i+4}a/=6}return{h:a,s:r,l:c}},e.hslToRgb=function(t,n,a){let r,o,s;if(0===n)r=o=s=a;else{e.hue2rgb=function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e};let c=a<.5?a*(1+n):a+n-a*n,i=2*a-c;r=hue2rgb(i,c,t+1/3),o=hue2rgb(i,c,t),s=hue2rgb(i,c,t-1/3)}return{r:255*r,g:255*o,b:255*s}},e.rgbToHsv=function(e,t,n){e/=255,t/=255,n/=255;let a,r,o=Math.max(e,t,n),s=Math.min(e,t,n),c=o,i=o-s;if(r=0===o?0:i/o,o===s)a=0;else{switch(o){case e:a=(t-n)/i+(t<n?6:0);break;case t:a=(n-e)/i+2;break;case n:a=(e-t)/i+4}a/=6}return{h:a,s:r,v:c}},e.hsvToRgb=function(e,t,n){let a,r,o,s=Math.floor(6*e),c=6*e-s,i=n*(1-t),l=n*(1-c*t),d=n*(1-(1-c)*t);switch(s%6){case 0:a=n,r=d,o=i;break;case 1:a=l,r=n,o=i;break;case 2:a=i,r=n,o=d;break;case 3:a=i,r=l,o=n;break;case 4:a=d,r=i,o=n;break;case 5:a=n,r=i,o=l}return{r:255*a,g:255*r,b:255*o}}}).call(this,n(3))}]);