window.ledc=function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return a}));const r={filename:null,channels:[],duration:0},a={params:{},tracks:[]};t.color={rgb:{r:255,g:0,b:0},hsl:{h:255,s:0,l:0}},t.updateRGB=function(){const{h:t,s:e,l:n}=color.hsl;color.rgb=hslToRgb(t,e,n)},t.updateHSL=function(){const{r:t,g:e,b:n}=color.rgb;color.hsl=rgbToHsl(t,e,n)},Object.assign(t,{CONFIG:{brightness:255,channel:0,show:0},AUDIO:r,LIGHT:a})}).call(this,n(3))},function(t,e,n){"use strict";n.r(e),n.d(e,"$",(function(){return a})),n.d(e,"setText",(function(){return o})),n.d(e,"setValue",(function(){return s})),n.d(e,"setProp",(function(){return c})),n.d(e,"setAttr",(function(){return i})),n.d(e,"click",(function(){return l})),n.d(e,"call",(function(){return u})),n.d(e,"renderHead",(function(){return d})),n.d(e,"renderShow",(function(){return f})),n.d(e,"renderLight",(function(){return h})),n.d(e,"renderWaveform",(function(){return b})),n.d(e,"render",(function(){return m}));var r=n(0);function a(t){return document.body.querySelectorAll(t)}function o(t,e){void 0!==e&&a(t).forEach(t=>{t.innerHTML=e})}function s(t,e){void 0!==e&&a(t).forEach(t=>{t.value=e})}function c(t,e,n){void 0!==n&&a(t).forEach(t=>{t[e]=n})}function i(t,e,n){void 0!==n&&a(t).forEach(t=>{t.setAttribute(e,n)})}function l(t){a(t).forEach(t=>{t.click()})}function u(t,e,...n){a(t).forEach(t=>{"function"==typeof t[e]&&t[e].call(t,...n)})}function d(){const{id:t,ip:e,mac:n,brightness:r,channel:a,show:s}=CONFIG;o("#id",t),o("#ip",e),o("#mac",n)}function f(){a("[data-show]").forEach(t=>{parseInt(t.dataset.show)===CONFIG.show?t.classList.add("selected"):t.classList.remove("selected")}),a(".tracks").forEach(t=>{t.innerHTML="",r.b.tracks.forEach(e=>{const n=document.createElement("div"),{elements:r,...a}=e;n.classList.add("track"),Object.assign(n.dataset,a),t.appendChild(n),h(n,e)})})}function h(t,e){switch(e.device){case 1:case 2:t.style.height="25px";break;default:return console.log("unsupported device type:",e.device)}e.elements.forEach(e=>{const n=document.createElement("span");let{color:r,colorStart:a,colorEnd:o,...s}=e;Object.assign(n.dataset,s);const c=s.startTime,i=s.endTime-e.startTime;let l,u;switch(r&&(r=g(r)),a&&(a=g(a)),o&&(o=g(o)),n.style.left=c/50+"px",n.style.width=i/50+"px",s.type){case 2:n.style.backgroundColor=p(r);break;case 3:l=p(a),u=p(o),n.style.background=`linear-gradient(90deg, ${l} 0%, ${u} 100%)`;break;case 4:l=p(a),u=p(o);const{period:t,ratio:e}=s;n.style.backgroundImage=`url(${function(t,e,n,r){w.width=n,w.height=1;const a=w.getContext("2d"),o=n*(r/100),s=n*((100-r)/100);return a.fillStyle=t,a.fillRect(0,0,o,1),a.fillStyle=e,a.fillRect(o,0,s,1),w.toDataURL()}(l,u,t,e)})`,n.style.backgroundSize="10%";break;case 5:n.style.backgroundImage=`url(${function(t){w.width=t,w.height=1;const e=w.getContext("2d");var n=e.createLinearGradient(0,0,t,0);return n.addColorStop(0,"red"),n.addColorStop(1/6*1,"orange"),n.addColorStop(1/6*2,"yellow"),n.addColorStop(.5,"green"),n.addColorStop(1/6*4,"cyan"),n.addColorStop(1/6*5,"blue"),n.addColorStop(1,"violet"),e.fillStyle=n,e.fillRect(0,0,t,1),w.toDataURL()}(s.period)})`,n.style.backgroundSize="10%";break;case 6:n.style.backgroundImage=`url(${function(t,e){w.width=e+2,w.height=1;const n=w.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,1,1),n.fillStyle="black",n.fillRect(1,0,1,1),w.toDataURL()}(p(r),s.spacing)})`,n.style.backgroundSize="10%";break;case 7:n.style.backgroundImage=`url(${function(t,e){w.width=e,w.height=1;const n=w.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,e,1),n.fillStyle="black",n.fillRect(0,0,24,1),n.fillStyle="white",n.fillRect(12,0,2,1),w.toDataURL()}(p(r),s.period)})`,n.style.backgroundSize="10%"}t.appendChild(n)})}function g({r:t,g:e,b:n}){return{r:Math.round(255*t),g:Math.round(255*e),b:Math.round(255*n)}}function p({r:t,g:e,b:n}){return`rgb(${t}, ${e}, ${n})`}const w=document.createElement("canvas");function b(){a("canvas.waveform").forEach((t,e)=>{const n=t.getContext("2d"),a=t.parentElement,o=r.a.channels[e].data,s=t.offsetHeight,c=50*r.a.duration,i=s/2;length=o.length;const l=Math.round(length/c);t.width=c,t.height=s,t.style.width=c+"px",t.style.height=s+"px",t.style.left=Math.round(a.clientWidth/2)+"px";let u=0,d=0,f=0,h=0,g=0,p=0,w=0,b=l;for(let t=0;t<length;t++)if(t==b){const t=f/p*i+i;n.strokeStyle="#eeeeee",n.strokeRect(u,t,1,d/w*i+i-t),u++,b+=l,d=0,f=0,h=0,g=0,p=0,w=0}else o[t]<0?(f+=o[t],p++,g>o[t]&&(g=o[t])):(d+=o[t],w++,h<o[t]&&(h=o[t]))})}function m(){d(),f()}Object.assign(window,{$:a,setText:o,setValue:s,setProp:c,setAttr:i,click:l,call:u,render:m})},function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(1);const{fetchData:a,post:o,uploadFile:s,get:c}=n(5),{parseAudio:i}=n(6),{parseLSF:l}=n(4);function u(){console.error(...arguments)}async function d(t){if(console.debug("select file: "+t.name),t.name.endsWith(".lsf")){const e=await l(t);1==e.length?(await s(`show/${CONFIG.show}A.lsb`,new Blob(e[0])),await s(`show/${CONFIG.show}B.lsb`,new Blob(e[0]))):3===e.length&&(await s(`show/${CONFIG.show}A.lsb`,new Blob(e[1])),await s(`show/${CONFIG.show}B.lsb`,new Blob(e[2]))),await a()}else if(t.name.endsWith(".lt3")){const e=`show/${CONFIG.show}.json`;await s(e,t),await a()}else t.name.endsWith(".ipx")||(t.type.startsWith("audio")?(Object(r.renderWaveform)(await i(t)),setAttr("#player","src",URL.createObjectURL(t))):console.error("unsupported file format"))}function f(t){if("change"===t.type&&"select-file"===t.target.id)for(let e of t.target.files)d(e);else if(t.target.matches("grid.color-slider input")){const e=t.target.dataset.key,n=t.target.dataset.group;switch(color[n][e]=parseFloat(t.target.value),n){case"rgb":updateHSL();break;case"hsl":updateRGB()}renderColor(),"change"===t.type&&o("/color",Object.assign({segment:CONFIG.segment},color.rgb))}else if(t.target.matches('input[data-group="audio"]')){const{key:e}=t.target.dataset,n=t.target.value;switch(t.target.type){case"color":AUDIO[e]=n;break;case"range":AUDIO[e]=parseFloat(n)}"change"===t.type&&console.info(`set ${e} = ${JSON.stringify(AUDIO[e])}`)}}window.addEventListener("scroll",(function(t){}),!0),window.addEventListener("dragover",(function(t){t.preventDefault()}),!0),window.addEventListener("dragleave",(function(t){t.preventDefault()}),!0),window.addEventListener("drop",(function(t){t.preventDefault();for(let e of t.dataTransfer.files)d(e)}),!0),window.addEventListener("change",f,!0),window.addEventListener("input",f,!0),window.addEventListener("click",(async function(t){if(t.target.dataset.segment)CONFIG.segment=t.target.dataset.segment,color={rgb:CONFIG[CONFIG.segment]},await updateHSL(),await render();else if(t.target.dataset.show)CONFIG.show=parseInt(t.target.dataset.show)||0,await render(),await o("show",{id:CONFIG.show}),CONFIG.show&&await loadShowData(),render();else if(t.target.dataset.action){switch(t.target.dataset.action){case"show-file-select-dialog":click("#select-file");break;case"reset-show-data":case"save-show-data":break;case"toggle-prop":const e=t.target.dataset.key;AUDIO[e]=!AUDIO[e],console.info(`set ${e} = ${AUDIO[e]?"on":"off"}`)}}else if(t.target.dataset.command){const e=t.target.dataset.command;switch(await o("exec?cmd="+e),e){case"start":setProp("#player","currentTime",0),call("#player","play");break;case"resume":call("#player","play");break;case"end":call("#player","pause"),setProp("#player","currentTime",0);break;case"pause":call("#player","pause")}}}),!0),window.addEventListener("touchstart",new Function,!0),window.addEventListener("load",(function(){a()}))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),n.d(e,"parseLSF",(function(){return s})),n.d(e,"parseLT3",(function(){return c}));const r=/(\t+)?([0-9]+)ms: setrgb [AB]+ ([0-9]+)ms > ([0-9]+), ([0-9]+), ([0-9]+)/i,a=/(\t+)?([0-9]+)ms: end/i,o=/([0-9]+)ms: loop ([0-9]+)ms/i;async function s(t){return new Promise(e=>{const n=new FileReader;n.readAsText(t),n.onload=()=>{const t={},s=n.result.match(/@?\w+[^@]+/gm).map(e=>{let n="AB";return e.startsWith("@")&&(n=e[1],e=e.substr(2)),t[n]=e.trim().split(/\r|\n|\r\n/).filter(t=>!!t.match(/^[\t0-9]/)).map(t=>{let e;if(e=t.match(r)){let[,,t,n,r,a,o]=e;return{type:1,start:t,duration:0,transition:n,r:r,g:a,b:o}}if(e=t.match(a)){let[,,t]=e;return{type:2,start:t}}if(e=t.match(o)){let[,t,n]=e;return{type:3,start:t,duration:n,frames:[]}}return{}}).map(({start:t=0,duration:e=0,transition:n=0,type:r=0,r:a=0,g:o=0,b:s=0},c,i)=>{const l=new Uint8Array(16),u=new DataView(l.buffer);1===r&&i[c+1]&&(e=i[c+1].start-t),u.setUint8(0,r),u.setUint32(1,t),u.setUint32(5,e),u.setUint32(9,n),u.setUint8(13,a),u.setUint8(14,o),u.setUint8(15,s);let d="";return l.forEach(t=>d+=t.toString(16).padStart(2,"0")+" "),console.log(d),l})});e(s)}})}async function c(t){}},function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"request",(function(){return o})),n.d(e,"uploadFile",(function(){return s})),n.d(e,"get",(function(){return c})),n.d(e,"post",(function(){return i})),n.d(e,"exec",(function(){return l})),n.d(e,"loadShowData",(function(){return u})),n.d(e,"fetchData",(function(){return d}));var r=n(0);const{render:a}=n(1);function o(t="POST",e="",n={},r=null){return new Promise((a,o)=>{const s=new XMLHttpRequest,c=Object.entries(n),i=e+(c.length?"?"+c.map(([t,e])=>`${t}=${e}`).join("&"):""),l=r?` [${r.size||r.length} Kb]`:"",u=console.log(`${t} ${i} ${l}... `);s.open(t,i,!0),s.send(r),s.addEventListener("load",()=>{u&&(u.innerHTML+=s.statusText),200===s.status?"application/json"===s.getResponseHeader("Content-Type")?a(JSON.parse(s.responseText),s):a(s.responseText,s):o()}),s.addEventListener("error",o)})}async function s(t,e,n=!1,r=null){const a=new Blob([e]),o=console.log(`UPLOAD ${t} [${(a.size/1e3).toFixed(2)} KB] ... `);return new Promise((e,s)=>{const c=new FormData,i=new XMLHttpRequest;c.append("filename",t),c.append("file",a),i.open("POST",`edit?${n?"sync":"nosync"}&${r?"target="+r:""}`,!0),i.send(c),i.onloadend=t=>{o&&(o.innerHTML+=i.statusText),200===i.status?e(i):s(i)}})}function c(t,e){return o("GET",t,e)}function i(t,e,n){return o("POST",t,e,n)}function l(t){return o("POST","exec",{cmd:t})}async function u(){try{const t=await c(`show/${CONFIG.show}.json`);r.b.params=t.solution,r.b.tracks=t.tracks}catch(t){console.log("show not available"),r.b.params={},r.b.tracks=[]}}async function d(){const t=await c("stat");Object.assign(CONFIG,t),t.show&&await u(),a()}Object.assign(t,{request:o,get:c,post:i,uploadFile:s,loadShowData:u,fetchData:d})}.call(this,n(3))},function(t,e,n){"use strict";n.r(e),n.d(e,"parseAudio",(function(){return s}));var r=n(0),a=n(2);const o=window.AudioContext||window.webkitAudioContext;async function s(t){return new Promise(e=>{const n=new o,s=new FileReader;s.readAsArrayBuffer(t),s.addEventListener("loadend",o=>{function c(t){const{sampleRate:n,duration:a}=t,o=[];for(let e=0;e<t.numberOfChannels;e++){const n=t.getChannelData(e),{tempo:r,beats:a,peaks:s,spectralFlux:c,...i}=new MusicTempo(n);a.forEach((t,e,n)=>n[e]=Math.round(1e3*t)),o[e]={data:n,beats:a,tempo:r}}e(Object.assign(r.a,{duration:a,channels:o}))}console.log(`decoding ${t.type}...`),"chrome"in window?n.decodeAudioData(s.result).catch(a.a).then(c):n.decodeAudioData(s.result,c,a.a)})})}},function(t,e,n){"use strict";n.r(e);n(4),n(8),n(0),n(1),n(5),n(6),n(2)},function(t,e,n){(function(t){t.rgbToHsl=function(t,e,n){t/=255,e/=255,n/=255;let r,a,o=Math.max(t,e,n),s=Math.min(t,e,n),c=(o+s)/2;if(o===s)r=a=0;else{let i=o-s;switch(a=c>.5?i/(2-o-s):i/(o+s),o){case t:r=(e-n)/i+(e<n?6:0);break;case e:r=(n-t)/i+2;break;case n:r=(t-e)/i+4}r/=6}return{h:r,s:a,l:c}},t.hslToRgb=function(e,n,r){let a,o,s;if(0===n)a=o=s=r;else{t.hue2rgb=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t};let c=r<.5?r*(1+n):r+n-r*n,i=2*r-c;a=hue2rgb(i,c,e+1/3),o=hue2rgb(i,c,e),s=hue2rgb(i,c,e-1/3)}return{r:255*a,g:255*o,b:255*s}},t.rgbToHsv=function(t,e,n){t/=255,e/=255,n/=255;let r,a,o=Math.max(t,e,n),s=Math.min(t,e,n),c=o,i=o-s;if(a=0===o?0:i/o,o===s)r=0;else{switch(o){case t:r=(e-n)/i+(e<n?6:0);break;case e:r=(n-t)/i+2;break;case n:r=(t-e)/i+4}r/=6}return{h:r,s:a,v:c}},t.hsvToRgb=function(t,e,n){let r,a,o,s=Math.floor(6*t),c=6*t-s,i=n*(1-e),l=n*(1-c*e),u=n*(1-(1-c)*e);switch(s%6){case 0:r=n,a=u,o=i;break;case 1:r=l,a=n,o=i;break;case 2:r=i,a=n,o=u;break;case 3:r=i,a=l,o=n;break;case 4:r=u,a=i,o=n;break;case 5:r=n,a=i,o=l}return{r:255*r,g:255*a,b:255*o}}}).call(this,n(3))}]);